<!DOCTYPE HTML> <!-- Declare HTML5 doctype -->
<head>
    <title>Micello Developer Example</title>
    <meta  name="viewport"  content="initial-scale=1.0,  user-scalable=no"  />
    <!-- Load micellomap.js from micello.com -->
    <script  type="text/javascript"  src="https://maps.micello.com/webmap/v0/micellomap.js"></script>
    <!-- Style the map container -- this is a full screen example -->
    <style type='text/css'>
        html {width:100%; height:100%; margin:0px;}
        body {width:100%; height:100%; margin:0px;}
        #mapElement { /* STYLE YOUR MAP */
            width: 100%;
            height: 100%;
        }
        input { margin: 0 3px;}
        .inputArea {position: absolute; top:20px; right:20px; z-index: 1000; font-size: 80%;}
    </style>
    <script type='text/javascript'>
        var mapDataObject;
	var count = 0;
	var micello_api_key = "kxpWh7vpk1y0YuWlUD6SlT5YUpOUcz";
	var micello_comm_key = "23616";
        micello.maps.init (micello_api_key,  mapInit);
	
	function getUrlVars() {
		var vars = {};
		var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
		vars[key] = value;
		});
	return vars;
	}

	function changeLevel() {
		var level = document.getElementById('gpsAlt').value;
		var drawing = mapDataObject.getCurrentDrawing();
		//mapDataObject.setLevel(drawing.l[parseInt(level)]);
		mapDataObject.setDrawing(comm.d[parseInt(level)]);
	}
	
        function  mapInit() {
            var mapControl =  new micello.maps.MapControl('mapElement');
            mapDataObject = mapControl.getMapData();
	    
	     var alt = getUrlVars()["ALT"]; // Get the altitude to determine floor level
		
		if(alt >= 0 && alt <= 7)
		{
			var floor = 0;
			var drawingID = 45173;
		}
		else if(alt >= 7 && alt <= 14)
		{
			var floor = 1
			var drawingID = 45174;
		}
		else
		{
			var floor = 2;
			var drawingID = 45175;
			
		}
		
		 document.getElementById('floor').value = floor;
		  document.getElementById('geoAlt').value = alt;
		// changeLevel();	      
		 
            // set up an override function for map changes so we can place the marker when the map loads
            mapDataObject.mapChanged = onMapChanged; // establish callback function for map changes
          //  mapDataObject.loadCommunity(micello_comm_key); // the location coordinates in this example are based on this community id
	     mapDataObject.loadCommunity(micello_comm_key,27514, drawingID); // cid, did, lid
        }
	
        function onMapChanged (e) { // all map changes trigger this method, including the inital loading
            if (e.comLoad) { // true on map load
	      show_gps_position();
            }
        }
	
        function show_gps_position () {
	if(count == 0)
	{
		var lat = getUrlVars()["LAT"];
		var longt = getUrlVars()["LON"];
		document.getElementById('gpsLat').value = lat;
		 document.getElementById('gpsLon').value = longt;
		 count++;
	 }
	
            var latitude = document.getElementById('gpsLat').value;
            var longitude = document.getElementById('gpsLon').value;
	    var floor = document.getElementById('floor').value;

            var thisLevel = mapDataObject.getCurrentLevel(); // get current level
	
            var gps_dot = {"src": "redPin.png", "ox":10, "oy":10}; // define image
            // use latLonToMxy to convert lat/lon into Micello coordinates
            var map_coords = mapDataObject.latLonToMxy(latitude, longitude);
            var gpsMarker = {
                "mx": map_coords[0],
                "my": map_coords[1],
                "lid": thisLevel.id,
                "mt": micello.maps.markertype.IMAGE,
                "mr": gps_dot, // the object defining the blue dot image
                "anm": "my_location", // part of the group 'tweets'
                "idat": "<div>"+latitude+", "+longitude+"</div>"
            }
            mapDataObject.removeMarkerOverlay("my_location", true); // Remove previous dot
            mapDataObject.addMarkerOverlay(gpsMarker); // using a global mapDataObject
        }
    </script>
<html xmlns:mso="urn:schemas-microsoft-com:office:office" xmlns:msdt="uuid:C2F41010-65B3-11d1-A29F-00AA00C14882">
<!--[if gte mso 9]><xml>
<mso:CustomDocumentProperties>
<mso:IsMyDocuments msdt:dt="string">1</mso:IsMyDocuments>
<mso:display_urn_x003a_schemas-microsoft-com_x003a_office_x003a_office_x0023_SharedWithUsers msdt:dt="string">Bourne Denis (L00099023);Mc Laughlin Breege (L00105058)</mso:display_urn_x003a_schemas-microsoft-com_x003a_office_x003a_office_x0023_SharedWithUsers>
<mso:SharedWithUsers msdt:dt="string">8;#Bourne Denis (L00099023);#9;#Mc Laughlin Breege (L00105058)</mso:SharedWithUsers>
</mso:CustomDocumentProperties>
</xml><![endif]-->
</head>
<body>
<div class="inputArea">
    Latitude : <input type="text" id="gpsLat" /><br>
    Longitude : <input type="text" id="gpsLon" /><br>
    Recorded Alt : <input type="text" id="geoAlt" /><br>
    Floor : <input type="text" id="floor" /><br>
    Room No : <input type="text" id="room_no" /><br>
    <input type="button" value="Update Position" onclick="show_gps_position()" />
<input type="button" value="Insert into database" onclick="changeLevel()" />
</div>

<div id='mapElement'></div>
<!--
</body>

//~ <?php
//~ if(isset($_GET['LAT'])) // If date is set
//~ 	{
//~ 		$lat = $_GET['LAT'];
//~ 	}
//~ 	else
//~ 	{
//~ 		$lat = null;
//~ 	}
//~
//~ 	if(isset($_GET['LON'])) // If date is set
//~ 	{
//~ 		$lon = $_GET['LON'];
//~ 	}
//~ 	else
//~ 	{
//~ 		$lon = null;
//~ 	}
//~

//~ print("<div class=inputArea>");
//~ print("Latitude : <input type=text id=gpsLat value=".$lat."/>");
//~ print("Longtitude : <input type=text id=gpsLon value=".$lon."/>");
//~ print("<input type=button value=Update Position onclick=show_gps_position()/>");
//~ print("</div>");
//~ print($lat);
//~ print($lon);
//~ echo($lat);
//~ echo($lon);
//~ ?>

<div id='mapElement'></div>-->
</body>
</HTML>